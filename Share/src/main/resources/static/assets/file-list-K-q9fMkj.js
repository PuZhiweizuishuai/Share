import{a as U,b as N,V as $}from"./view-log-list-CehLEICz.js";import{_ as K,c as p,w as l,f as E,o as m,g as z,b as a,h as B,i,t as r,e as L,j as V,k as n,l as O,a as u,m as g,n as P,p as X,q as M,s as D,u as T,v as b,x as c,d as S,V as w,y as G,z as j,r as q}from"./index-Cf-_bI7v.js";import{V as v,a as y,b as C,c as F}from"./VCard-Dc1DeU81.js";import{V as H}from"./VSwitch-C00PYh72.js";import"./VSelect-BHIV387k.js";function J(e,t){var f,o;const d=t.value,k={passive:!((f=t.modifiers)!=null&&f.active)};window.addEventListener("resize",d,k),e._onResize=Object(e._onResize),e._onResize[t.instance.$.uid]={handler:d,options:k},(o=t.modifiers)!=null&&o.quiet||d()}function W(e,t){var f;if(!((f=e._onResize)!=null&&f[t.instance.$.uid]))return;const{handler:d,options:k}=e._onResize[t.instance.$.uid];window.removeEventListener("resize",d,k),delete e._onResize[t.instance.$.uid]}const x={mounted:J,unmounted:W},A={name:"File",components:{ViewLogTable:U},data:()=>({dialog:!1,headers:[{title:"上传日期",sortable:!1,key:"createTime"},{title:"文件名",sortable:!1,key:"uploadFilename"},{title:"路径",sortable:!1,key:"path"},{title:"大小",sortable:!1,key:"size"},{title:"状态",sortable:!1,key:"status"},{title:"操作",key:"actions",sortable:!1}],fileList:[],page:1,size:20,pageCount:0,total:0,deleteItemDate:{uploadFilename:""},showDelete:!1,useSize:0,availableDisk:0,snackbar:!1,message:"删除成功",color:"success",showRename:!1,renameFileDate:{uploadFilename:""},newName:"",loading:!0,windowSize:{x:window.innerWidth,y:window.innerHeight},mobileStatus:!1,showShareDialog:!1,shareItem:{haveUserSeeKey:!1,userSeeKey:""},showseccussShareDialog:!1,successShareInfo:"",showShareBtn:!1,showSeeShareStatusDialog:!1,showShareStatusItme:{},nowCount:20}),created(){const e=parseInt(this.$route.query.page);isNaN(e)||(e<=0?this.page=1:this.page=e),this.initialize(),this.getDiskMessage(),this.checkLogin()},methods:{copy(){navigator.clipboard.writeText(this.successShareInfo)},cancelShare(){this.showShareStatusItme.createTime=0,this.showShareStatusItme.size=0,this.httpPost("/public/file/cancel",this.showShareStatusItme,e=>{e.data?(this.message="取消成功",this.snackbar=!0,this.initialize(),this.showSeeShareStatusDialog=!1):(this.message="取消失败",this.snackbar=!0,this.showSeeShareStatusDialog=!1)})},showShareStatus(e){this.showShareStatusItme=e,this.successShareInfo=`链接：${location.origin}/#/share/file/${this.showShareStatusItme.url}`,this.showShareStatusItme.haveUserSeeKey&&(this.successShareInfo+=`
密码：${this.showShareStatusItme.userSeeKey}`),this.showSeeShareStatusDialog=!0},checkLogin(){this.httpGet("/login/check",e=>{e.status==200?this.showShareBtn=!0:this.showShareBtn=!1})},showShareFileDilog(e){this.shareItem=e,this.showShareDialog=!0},sendSaveShare(){this.shareItem.size=0,this.shareItem.createTime=0,this.httpPost("/public/file",this.shareItem,e=>{e.data!=null?(this.successShareInfo=`链接：${location.origin}/#/share/file/${e.data.url}`,this.shareItem.haveUserSeeKey&&(this.successShareInfo+=`
密码：${this.shareItem.userSeeKey}`),this.showseccussShareDialog=!0,this.showShareDialog=!1,this.initialize()):(this.message=e.message,this.snackbar=!0)})},showFileName(e){return e.length>=40?e.substr(0,15)+"..."+e.substr(e.length-10,10):e},onResize(){this.windowSize={x:window.innerWidth,y:window.innerHeight},this.windowSize.x<=800?this.mobileStatus=!0:this.mobileStatus=!1},pageChange({page:e,itemsPerPage:t,sortBy:d}){this.loading=!0,this.page=e,this.$router.push({path:this.$router.path,query:{page:e}}),this.initialize()},getDiskMessage(){fetch("/api/upload/disk",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"GET",credentials:"include"}).then(e=>e.json()).then(e=>{const t=e.data.userDisk/1024/1024;t<1024?this.useSize=t.toFixed(2)+"MB":this.useSize=(t/1024).toFixed(2)+"GB";const d=e.data.availableDisk/1024/1024;d<1024?this.availableDisk=d.toFixed(2)+"MB":this.availableDisk=(d/1024).toFixed(2)+"GB"}).catch(e=>null)},initialize(){fetch(`/api/file/list?page=${this.page}&size=${this.size}`,{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"GET",credentials:"include"}).then(e=>e.json()).then(e=>{this.nowCount=e.page.size,this.fileList=e.page.content,this.total=e.page.totalElements,this.pageCount=e.page.totalPages,this.loading=!1}).catch(e=>null)},editItem(e){this.renameFileDate=e,this.showRename=!0},reNameOk(){console.log("ok"),this.newName!==""&&(this.renameFileDate.uploadFilename=this.newName,this.renameFileDate.size=0,this.renameFileDate.createTime=0,fetch("/api/file/rename",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"POST",credentials:"include",body:JSON.stringify(this.renameFileDate)}).then(e=>e.json()).then(e=>{e.status===200?(this.message="修改成功！",this.color="success"):(this.message="修改失败！"+e.message,this.color="error"),this.snackbar=!0,this.showRename=!1,this.initialize()}).catch(e=>null))},deleteItem(e){this.deleteItemDate=e,this.showDelete=!0},deleteFile(){console.log(this.deleteItemDate),this.deleteItemDate.size=0,this.deleteItemDate.createTime=0,fetch("/api/file/delete",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"DELETE",credentials:"include",body:JSON.stringify(this.deleteItemDate)}).then(e=>e.json()).then(e=>{e.status===200?(this.message="删除成功！",this.color="success",this.initialize(),this.getDiskMessage()):(this.message="删除失败！"+e.message,this.color="error"),this.showDelete=!1,this.snackbar=!0,this.initialize(),this.getDiskMessage()}).catch(e=>null)},formateTimeToChinese(e){if(e===""||e==null)return"";const t=new Date(e);return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+t.getHours()+"时"+t.getMinutes()+"分"},showSize(e){return e=e/1024,e<1024?e.toFixed(2)+" KB":(e/1024).toFixed(2)+" M"}}},Y={key:1},Q=["href"],Z={class:"text-center pt-2"},_=["textContent"],ee=["textContent"],te=["textContent"];function ae(e,t,d,k,f,o){const R=q("ViewLogTable");return m(),p(E,{fluid:"",style:{width:"100%"}},{default:l(()=>[z((m(),p(N,{headers:e.headers,items:e.fileList,itemsLength:e.nowCount,"hide-default-footer":"",page:e.page,"onUpdate:page":t[1]||(t[1]=s=>e.page=s),"item-value":"createTime","items-per-page":e.size,"onUpdate:itemsPerPage":t[2]||(t[2]=s=>e.size=s),"onUpdate:options":o.pageChange,loading:e.loading,mobile:e.mobileStatus},{top:l(()=>[a(O,{flat:"",color:"white"},{default:l(()=>[a(B,null,{default:l(()=>[i("已使用空间："+r(e.useSize)+" 系统剩余空间："+r(e.availableDisk),1)]),_:1}),a(L,{class:"mx-4",inset:"",vertical:""}),a(V),a(n,{color:"primary",onClick:o.initialize},{default:l(()=>t[21]||(t[21]=[i("刷新文件列表")])),_:1},8,["onClick"])]),_:1})]),"item.createTime":l(({item:s})=>[u("span",null,r(o.formateTimeToChinese(s.createTime)),1)]),"item.size":l(({item:s})=>[u("span",null,r(o.showSize(s.size)),1)]),"item.uploadFilename":l(({item:s})=>[s.uploadFilename.length>=40?(m(),p(g,{key:0,location:"top",text:s.uploadFilename},{activator:l(({props:h})=>[u("span",P(X(h)),r(o.showFileName(s.uploadFilename)),17)]),_:2},1032,["text"])):(m(),M("span",Y,r(o.showFileName(s.uploadFilename)),1))]),"item.path":l(({item:s})=>[u("a",{class:"overflow-auto",href:`${s.path}?filename=${encodeURIComponent(s.uploadFilename)}&type=inline`,target:"_blank"},r(s.path),9,Q)]),"item.status":l(({item:s})=>[s.publicUser?(m(),p(g,{key:0,location:"start",text:"已共享，点击查看信息！"},{activator:l(({props:h})=>[a(n,D({class:"mr-2",variant:"outlined",density:"compact",color:"deep-purple"},h,{onClick:I=>o.showShareStatus(s)}),{default:l(()=>t[22]||(t[22]=[i(" 已共享 ")])),_:2},1040,["onClick"])]),_:2},1024)):T("",!0)]),"item.actions":l(({item:s})=>[a(g,{location:"start",text:"下载"},{activator:l(({props:h})=>[a(n,D({class:"mr-2",icon:"mdi-download",density:"compact",color:"success"},h,{target:"_blank",href:`${s.path}?filename=${encodeURIComponent(s.uploadFilename)}&type=attachment`}),null,16,["href"])]),_:2},1024),e.showShareBtn?(m(),p(g,{key:0,location:"start",text:"分享"},{activator:l(({props:h})=>[a(n,D({onClick:I=>o.showShareFileDilog(s),class:"mr-2",icon:"mdi-share",density:"compact",color:"blue"},h),null,16,["onClick"])]),_:2},1024)):T("",!0),a(g,{location:"start",text:"重命名"},{activator:l(({props:h})=>[a(n,D({class:"mr-2",icon:"mdi-pencil",density:"compact"},h,{onClick:I=>o.editItem(s)}),null,16,["onClick"])]),_:2},1024),a(g,{location:"start",text:"删除文件"},{activator:l(({props:h})=>[a(n,D({class:"mr-2",density:"compact",icon:"mdi-delete",color:"error"},h,{onClick:I=>o.deleteItem(s)}),null,16,["onClick"])]),_:2},1024)]),bottom:l(()=>[u("div",Z,[a($,{modelValue:e.page,"onUpdate:modelValue":t[0]||(t[0]=s=>e.page=s),color:"blue","total-visible":5,length:e.pageCount,rounded:"circle"},null,8,["modelValue","length"])])]),_:1},8,["headers","items","itemsLength","page","items-per-page","onUpdate:options","loading","mobile"])),[[x,o.onResize]]),a(b,{modelValue:e.showDelete,"onUpdate:modelValue":t[5]||(t[5]=s=>e.showDelete=s),"max-width":"490"},{default:l(()=>[a(v,null,{default:l(()=>[a(y,{class:"headline"},{default:l(()=>t[23]||(t[23]=[i("你确定要删除这个文件吗？")])),_:1}),a(C,null,{default:l(()=>[u("span",{textContent:r(e.deleteItemDate.uploadFilename)},null,8,_),t[24]||(t[24]=i()),t[25]||(t[25]=u("br",null,null,-1)),t[26]||(t[26]=u("br",null,null,-1)),t[27]||(t[27]=i(" 删除后将无法恢复，请谨慎操作！！！ "))]),_:1}),a(F,null,{default:l(()=>[a(V),a(n,{color:"green darken-1",text:"",onClick:t[3]||(t[3]=s=>e.showDelete=!1)},{default:l(()=>t[28]||(t[28]=[i(" 放弃 ")])),_:1}),a(n,{color:"error",text:"",onClick:t[4]||(t[4]=s=>o.deleteFile())},{default:l(()=>t[29]||(t[29]=[i(" 确认 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(b,{modelValue:e.showRename,"onUpdate:modelValue":t[8]||(t[8]=s=>e.showRename=s),"max-width":"490"},{default:l(()=>[a(v,null,{default:l(()=>[a(y,{class:"headline"},{default:l(()=>t[30]||(t[30]=[i("修改文件名")])),_:1}),a(C,null,{default:l(()=>[t[31]||(t[31]=i(" 原文件名：")),u("span",{textContent:r(e.renameFileDate.uploadFilename)},null,8,ee)]),_:1}),a(c,{modelValue:e.newName,"onUpdate:modelValue":t[6]||(t[6]=s=>e.newName=s),variant:"underlined",style:{"margin-right":"20px","margin-left":"20px"},label:"新文件名"},null,8,["modelValue"]),a(F,null,{default:l(()=>[a(V),a(n,{color:"green darken-1",text:"",onClick:t[7]||(t[7]=s=>e.showRename=!1)},{default:l(()=>t[32]||(t[32]=[i(" 放弃 ")])),_:1}),a(n,{color:"error",text:"",onClick:o.reNameOk},{default:l(()=>t[33]||(t[33]=[i(" 确认 ")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(b,{modelValue:e.showShareDialog,"onUpdate:modelValue":t[13]||(t[13]=s=>e.showShareDialog=s),"max-width":"490"},{default:l(()=>[a(v,null,{default:l(()=>[a(y,{class:"headline"},{default:l(()=>t[34]||(t[34]=[i("你要将这份文件分享出去吗？")])),_:1}),a(C,null,{default:l(()=>[u("p",null,[u("span",{textContent:r(e.shareItem.uploadFilename)},null,8,te),t[35]||(t[35]=u("br",null,null,-1)),t[36]||(t[36]=i(" 分享后在任何人均可查看 "))]),u("p",null,[a(S,{justify:"center"},{default:l(()=>[a(w,null,{default:l(()=>[a(H,{modelValue:e.shareItem.haveUserSeeKey,"onUpdate:modelValue":t[9]||(t[9]=s=>e.shareItem.haveUserSeeKey=s),color:"blue",label:"是否启用密码"},null,8,["modelValue"])]),_:1})]),_:1}),z(a(S,{justify:"center"},{default:l(()=>[a(w,null,{default:l(()=>[a(c,{modelValue:e.shareItem.userSeeKey,"onUpdate:modelValue":t[10]||(t[10]=s=>e.shareItem.userSeeKey=s),placeholder:"密码",label:"密码",clearable:"",variant:"underlined"},null,8,["modelValue"])]),_:1})]),_:1},512),[[G,e.shareItem.haveUserSeeKey]])])]),_:1}),a(F,null,{default:l(()=>[a(V),a(n,{color:"green darken-1",text:"",onClick:t[11]||(t[11]=s=>e.showShareDialog=!1)},{default:l(()=>t[37]||(t[37]=[i(" 放弃 ")])),_:1}),a(n,{color:"error",text:"",onClick:t[12]||(t[12]=s=>o.sendSaveShare())},{default:l(()=>t[38]||(t[38]=[i(" 确认 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(b,{modelValue:e.showseccussShareDialog,"onUpdate:modelValue":t[15]||(t[15]=s=>e.showseccussShareDialog=s),"max-width":"490"},{default:l(()=>[a(v,null,{default:l(()=>[a(y,{class:"headline"},{default:l(()=>t[39]||(t[39]=[i("分享成功，复制下面内容给你的好友吧！")])),_:1}),a(C,null,{default:l(()=>[a(S,null,{default:l(()=>[a(w,null,{default:l(()=>[i(r(e.successShareInfo),1)]),_:1})]),_:1}),a(S,null,{default:l(()=>[a(w,null,{default:l(()=>[a(n,{color:"blue-lighten-5",onClick:t[14]||(t[14]=s=>o.copy())},{default:l(()=>t[40]||(t[40]=[i("复制")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(b,{modelValue:e.showSeeShareStatusDialog,"onUpdate:modelValue":t[19]||(t[19]=s=>e.showSeeShareStatusDialog=s),"max-width":"1000"},{default:l(()=>[a(v,null,{default:l(()=>[a(y,{class:"headline"},{default:l(()=>t[41]||(t[41]=[i("分享")])),_:1}),a(C,null,{default:l(()=>[a(S,null,{default:l(()=>[a(w,null,{default:l(()=>[i(r(e.successShareInfo),1)]),_:1})]),_:1}),a(S,null,{default:l(()=>[a(w,null,{default:l(()=>[a(n,{color:"blue-lighten-5",onClick:t[16]||(t[16]=s=>o.copy())},{default:l(()=>t[42]||(t[42]=[i("复制")])),_:1})]),_:1})]),_:1}),a(R,{target:e.showShareStatusItme.id,types:1},null,8,["target"])]),_:1}),a(F,null,{default:l(()=>[a(V),a(n,{color:"green darken-1",text:"",onClick:t[17]||(t[17]=s=>e.showSeeShareStatusDialog=!1)},{default:l(()=>t[43]||(t[43]=[i(" 关闭 ")])),_:1}),e.showShareBtn?(m(),p(n,{key:0,color:"error",text:"",onClick:t[18]||(t[18]=s=>o.cancelShare())},{default:l(()=>t[44]||(t[44]=[i(" 取消分享 ")])),_:1})):T("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(j,{modelValue:e.snackbar,"onUpdate:modelValue":t[20]||(t[20]=s=>e.snackbar=s),color:e.color,timeout:3e3,top:!0},{default:l(()=>[i(r(e.message),1)]),_:1},8,["modelValue","color"])]),_:1})}const re=K(A,[["render",ae],["__scopeId","data-v-770c87b4"]]);export{re as default};
