import{_ as X,d as P,c as p,w as s,r as i,o as m,e as z,a as t,f as o,t as d,b as u,n as M,g as L,h as G,m as _,i as y,v as x,p as H,j as q}from"./index-lJKHgFaS.js";const J={name:"File",data:()=>({dialog:!1,headers:[{align:"start",title:"上传日期",sortable:!1,key:"createTime"},{title:"文件名",sortable:!1,key:"uploadFilename"},{title:"路径",sortable:!1,key:"path"},{title:"大小",sortable:!1,key:"size"},{title:"状态",sortable:!1,key:"status"},{title:"操作",key:"actions",sortable:!1}],fileList:[],page:1,size:20,pageCount:0,total:0,deleteItemDate:{uploadFilename:""},showDelete:!1,useSize:0,availableDisk:0,snackbar:!1,message:"删除成功",color:"success",showRename:!1,renameFileDate:{uploadFilename:""},newName:"",loading:!0,windowSize:{x:window.innerWidth,y:window.innerHeight},mobileStatus:!1,showShareDialog:!1,shareItem:{haveUserSeeKey:!1,userSeeKey:""},showseccussShareDialog:!1,successShareInfo:"",showShareBtn:!1,showSeeShareStatusDialog:!1,showShareStatusItme:{}}),created(){const e=parseInt(this.$route.query.page);isNaN(e)||(e<=0?this.page=1:this.page=e),this.initialize(),this.getDiskMessage(),this.checkLogin()},methods:{cancelShare(){this.showShareStatusItme.createTime=0,this.showShareStatusItme.size=0,this.httpPost("/public/file/cancel",this.showShareStatusItme,e=>{e.data?(this.message="取消成功",this.snackbar=!0,this.initialize(),this.showSeeShareStatusDialog=!1):(this.message="取消失败",this.snackbar=!0,this.showSeeShareStatusDialog=!1)})},showShareStatus(e){this.showShareStatusItme=e,this.successShareInfo=`链接：${location.origin}/share/file/${this.showShareStatusItme.url}`,this.showShareStatusItme.haveUserSeeKey&&(this.successShareInfo+=`
密码：${this.showShareStatusItme.userSeeKey}`),this.showSeeShareStatusDialog=!0},checkLogin(){this.httpGet("/login/check",e=>{e.status==200?this.showShareBtn=!0:this.showShareBtn=!1})},showShareFileDilog(e){this.shareItem=e,this.showShareDialog=!0},sendSaveShare(){this.shareItem.size=0,this.shareItem.createTime=0,this.httpPost("/public/file",this.shareItem,e=>{e.data!=null?(this.successShareInfo=`链接：${location.origin}/share/file/${e.data.url}`,this.shareItem.haveUserSeeKey&&(this.successShareInfo+=`
密码：${this.shareItem.userSeeKey}`),this.showseccussShareDialog=!0,this.showShareDialog=!1,this.initialize()):(this.message=e.message,this.snackbar=!0)})},showFileName(e){return e.length>=40?e.substr(0,15)+"..."+e.substr(e.length-10,10):e},onResize(){this.windowSize={x:window.innerWidth,y:window.innerHeight},this.windowSize.x<=800?this.mobileStatus=!0:this.mobileStatus=!1},pageChange({page:e,itemsPerPage:a,sortBy:f}){this.loading=!0,this.page=e,this.$router.push({path:this.$router.path,query:{page:e}}),this.initialize()},getDiskMessage(){fetch("/api/upload/disk",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"GET",credentials:"include"}).then(e=>e.json()).then(e=>{const a=e.data.userDisk/1024/1024;a<1024?this.useSize=a.toFixed(2)+"MB":this.useSize=(a/1024).toFixed(2)+"GB";const f=e.data.availableDisk/1024/1024;f<1024?this.availableDisk=f.toFixed(2)+"MB":this.availableDisk=(f/1024).toFixed(2)+"GB"}).catch(e=>null)},initialize(){fetch(`/api/file/list?page=${this.page}&size=${this.size}`,{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"GET",credentials:"include"}).then(e=>e.json()).then(e=>{for(var a=0;a<e.page.content.length;a++)e.page.content[a].createTime=this.formateTimeToChinese(e.page.content[a].createTime),e.page.content[a].size=this.showSize(e.page.content[a].size);this.fileList=e.page.content,this.total=e.page.totalElements,this.pageCount=e.page.totalPages,this.loading=!1}).catch(e=>null)},editItem(e){this.renameFileDate=e,this.showRename=!0},reNameOk(){console.log("ok"),this.newName!==""&&(this.renameFileDate.uploadFilename=this.newName,this.renameFileDate.size=0,this.renameFileDate.createTime=0,fetch("/api/file/rename",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"POST",credentials:"include",body:JSON.stringify(this.renameFileDate)}).then(e=>e.json()).then(e=>{e.status===200?(this.message="修改成功！",this.color="success"):(this.message="修改失败！"+e.message,this.color="error"),this.snackbar=!0,this.showRename=!1,this.initialize()}).catch(e=>null))},deleteItem(e){this.deleteItemDate=e,this.showDelete=!0},deleteFile(){console.log(this.deleteItemDate),this.deleteItemDate.size=0,this.deleteItemDate.createTime=0,fetch("/api/file/delete",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"DELETE",credentials:"include",body:JSON.stringify(this.deleteItemDate)}).then(e=>e.json()).then(e=>{e.status===200?(this.message="删除成功！",this.color="success",this.initialize(),this.getDiskMessage()):(this.message="删除失败！"+e.message,this.color="error"),this.showDelete=!1,this.snackbar=!0,this.initialize(),this.getDiskMessage()}).catch(e=>null)},formateTimeToChinese(e){if(e===""||e==null)return"";const a=new Date(e);return a.getFullYear()+"年"+(a.getMonth()+1)+"月"+a.getDate()+"日 "+a.getHours()+"时"+a.getMinutes()+"分"},showSize(e){return e=e/1024,e<1024?e.toFixed(2)+" KB":(e/1024).toFixed(2)+" M"}}},F=e=>(H("data-v-826f3fe7"),e=e(),q(),e),W={key:1},Y=["href"],A={class:"text-center pt-2"},Q=["textContent"],Z=F(()=>u("br",null,null,-1)),j=F(()=>u("br",null,null,-1)),ee=["textContent"],te=["textContent"],ae=F(()=>u("br",null,null,-1));function se(e,a,f,le,oe,r){const T=i("v-toolbar-title"),U=i("v-divider"),g=i("v-spacer"),n=i("v-btn"),N=i("v-toolbar"),c=i("v-tooltip"),K=i("v-pagination"),R=i("v-data-table-server"),S=i("v-card-title"),v=i("v-card-text"),b=i("v-card-actions"),w=i("v-card"),k=i("v-dialog"),I=i("v-text-field"),$=i("v-switch"),C=i("v-col"),V=i("v-row"),B=i("v-snackbar"),E=i("v-container"),O=P("resize");return m(),p(E,{fluid:""},{default:s(()=>[z((m(),p(R,{density:"compact",headers:e.headers,items:e.fileList,page:e.page,"onUpdate:page":a[1]||(a[1]=l=>e.page=l),"item-value":"createTime","items-per-page":e.size,"onUpdate:itemsPerPage":a[2]||(a[2]=l=>e.size=l),"onUpdate:options":r.pageChange,loading:e.loading,mobile:e.mobileStatus},{top:s(()=>[t(N,{flat:"",color:"white"},{default:s(()=>[t(T,null,{default:s(()=>[o("已使用空间："+d(e.useSize)+" 系统剩余空间："+d(e.availableDisk),1)]),_:1}),t(U,{class:"mx-4",inset:"",vertical:""}),t(g),t(n,{color:"primary",onClick:r.initialize},{default:s(()=>[o("刷新文件列表")]),_:1},8,["onClick"])]),_:1})]),"item.uploadFilename":s(({item:l})=>[l.uploadFilename.length>=40?(m(),p(c,{key:0,location:"top",text:l.uploadFilename},{activator:s(({props:h})=>[u("span",M(L(h)),d(r.showFileName(l.uploadFilename)),17)]),_:2},1032,["text"])):(m(),G("span",W,d(r.showFileName(l.uploadFilename)),1))]),"item.path":s(({item:l})=>[u("a",{class:"overflow-auto",href:`${l.path}?filename=${encodeURIComponent(l.uploadFilename)}&type=inline`,target:"_blank"},d(l.path),9,Y)]),"item.status":s(({item:l})=>[l.publicUser?(m(),p(c,{key:0,location:"start",text:"已共享，点击查看信息！"},{activator:s(({props:h})=>[t(n,_({class:"mr-2",variant:"outlined",density:"compact",color:"deep-purple"},h,{onClick:D=>r.showShareStatus(l)}),{default:s(()=>[o(" 已共享 ")]),_:2},1040,["onClick"])]),_:2},1024)):y("",!0)]),"item.actions":s(({item:l})=>[t(c,{location:"start",text:"下载"},{activator:s(({props:h})=>[t(n,_({class:"mr-2",icon:"mdi-download",density:"compact",color:"success"},h,{target:"_blank",href:`${l.path}?filename=${encodeURIComponent(l.uploadFilename)}&type=attachment`}),null,16,["href"])]),_:2},1024),e.showShareBtn?(m(),p(c,{key:0,location:"start",text:"分享"},{activator:s(({props:h})=>[t(n,_({onClick:D=>r.showShareFileDilog(l),class:"mr-2",icon:"mdi-share",density:"compact",color:"blue"},h),null,16,["onClick"])]),_:2},1024)):y("",!0),t(c,{location:"start",text:"重命名"},{activator:s(({props:h})=>[t(n,_({class:"mr-2",icon:"mdi-pencil",density:"compact"},h,{onClick:D=>r.editItem(l)}),null,16,["onClick"])]),_:2},1024),t(c,{location:"start",text:"删除文件"},{activator:s(({props:h})=>[t(n,_({class:"mr-2",density:"compact",icon:"mdi-delete",color:"error"},h,{onClick:D=>r.deleteItem(l)}),null,16,["onClick"])]),_:2},1024)]),"no-data":s(()=>[t(n,{color:"primary",onClick:r.initialize},{default:s(()=>[o("Reset")]),_:1},8,["onClick"])]),bottom:s(()=>[u("div",A,[t(K,{modelValue:e.page,"onUpdate:modelValue":a[0]||(a[0]=l=>e.page=l),color:"blue","total-visible":5,length:e.pageCount,rounded:"circle"},null,8,["modelValue","length"])])]),_:1},8,["headers","items","page","items-per-page","onUpdate:options","loading","mobile"])),[[O,r.onResize]]),t(k,{modelValue:e.showDelete,"onUpdate:modelValue":a[5]||(a[5]=l=>e.showDelete=l),"max-width":"490"},{default:s(()=>[t(w,null,{default:s(()=>[t(S,{class:"headline"},{default:s(()=>[o("你确定要删除这个文件吗？")]),_:1}),t(v,null,{default:s(()=>[u("span",{textContent:d(e.deleteItemDate.uploadFilename)},null,8,Q),o(),Z,j,o(" 删除后将无法恢复，请谨慎操作！！！ ")]),_:1}),t(b,null,{default:s(()=>[t(g),t(n,{color:"green darken-1",text:"",onClick:a[3]||(a[3]=l=>e.showDelete=!1)},{default:s(()=>[o(" 放弃 ")]),_:1}),t(n,{color:"error",text:"",onClick:a[4]||(a[4]=l=>r.deleteFile())},{default:s(()=>[o(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(k,{modelValue:e.showRename,"onUpdate:modelValue":a[8]||(a[8]=l=>e.showRename=l),"max-width":"490"},{default:s(()=>[t(w,null,{default:s(()=>[t(S,{class:"headline"},{default:s(()=>[o("修改文件名")]),_:1}),t(v,null,{default:s(()=>[o(" 原文件名："),u("span",{textContent:d(e.renameFileDate.uploadFilename)},null,8,ee)]),_:1}),t(I,{modelValue:e.newName,"onUpdate:modelValue":a[6]||(a[6]=l=>e.newName=l),variant:"underlined",style:{"margin-right":"20px","margin-left":"20px"},label:"新文件名"},null,8,["modelValue"]),t(b,null,{default:s(()=>[t(g),t(n,{color:"green darken-1",text:"",onClick:a[7]||(a[7]=l=>e.showRename=!1)},{default:s(()=>[o(" 放弃 ")]),_:1}),t(n,{color:"error",text:"",onClick:r.reNameOk},{default:s(()=>[o(" 确认 ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(k,{modelValue:e.showShareDialog,"onUpdate:modelValue":a[13]||(a[13]=l=>e.showShareDialog=l),"max-width":"490"},{default:s(()=>[t(w,null,{default:s(()=>[t(S,{class:"headline"},{default:s(()=>[o("你要将这份文件分享出去吗？")]),_:1}),t(v,null,{default:s(()=>[u("p",null,[u("span",{textContent:d(e.shareItem.uploadFilename)},null,8,te),ae,o(" 分享后在任何人均可查看 ")]),u("p",null,[t(V,{justify:"center"},{default:s(()=>[t(C,null,{default:s(()=>[t($,{modelValue:e.shareItem.haveUserSeeKey,"onUpdate:modelValue":a[9]||(a[9]=l=>e.shareItem.haveUserSeeKey=l),color:"blue",label:"是否启用密码"},null,8,["modelValue"])]),_:1})]),_:1}),z(t(V,{justify:"center"},{default:s(()=>[t(C,null,{default:s(()=>[t(I,{modelValue:e.shareItem.userSeeKey,"onUpdate:modelValue":a[10]||(a[10]=l=>e.shareItem.userSeeKey=l),placeholder:"密码",label:"密码",clearable:"",variant:"underlined"},null,8,["modelValue"])]),_:1})]),_:1},512),[[x,e.shareItem.haveUserSeeKey]])])]),_:1}),t(b,null,{default:s(()=>[t(g),t(n,{color:"green darken-1",text:"",onClick:a[11]||(a[11]=l=>e.showShareDialog=!1)},{default:s(()=>[o(" 放弃 ")]),_:1}),t(n,{color:"error",text:"",onClick:a[12]||(a[12]=l=>r.sendSaveShare())},{default:s(()=>[o(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(k,{modelValue:e.showseccussShareDialog,"onUpdate:modelValue":a[14]||(a[14]=l=>e.showseccussShareDialog=l),"max-width":"490"},{default:s(()=>[t(w,null,{default:s(()=>[t(S,{class:"headline"},{default:s(()=>[o("分享成功，复制下面内容给你的好友吧！")]),_:1}),t(v,null,{default:s(()=>[o(d(e.successShareInfo),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(k,{modelValue:e.showSeeShareStatusDialog,"onUpdate:modelValue":a[17]||(a[17]=l=>e.showSeeShareStatusDialog=l),"max-width":"490"},{default:s(()=>[t(w,null,{default:s(()=>[t(S,{class:"headline"},{default:s(()=>[o("分享")]),_:1}),t(v,null,{default:s(()=>[o(d(e.successShareInfo),1)]),_:1}),t(b,null,{default:s(()=>[t(g),t(n,{color:"green darken-1",text:"",onClick:a[15]||(a[15]=l=>e.showSeeShareStatusDialog=!1)},{default:s(()=>[o(" 关闭 ")]),_:1}),e.showShareBtn?(m(),p(n,{key:0,color:"error",text:"",onClick:a[16]||(a[16]=l=>r.cancelShare())},{default:s(()=>[o(" 取消分享 ")]),_:1})):y("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(B,{modelValue:e.snackbar,"onUpdate:modelValue":a[18]||(a[18]=l=>e.snackbar=l),color:e.color,timeout:3e3,top:!0},{default:s(()=>[o(d(e.message),1)]),_:1},8,["modelValue","color"])]),_:1})}const ne=X(J,[["render",se],["__scopeId","data-v-826f3fe7"]]);export{ne as default};
