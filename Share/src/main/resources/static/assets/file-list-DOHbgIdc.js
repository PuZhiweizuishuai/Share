import{b as N,c as $,a as K,V as B}from"./VSwitch-BerFYsyx.js";import{_ as E,c as p,w as s,V as O,o as m,g as z,a,h as L,i,t as h,f as P,j as k,k as n,l as X,m as c,d,n as _,p as M,q as G,s as V,u as I,v,x as R,e as g,b as S,y as q,z as H,r as x,A,B as J}from"./index-BkN6O-Cq.js";import{V as D,a as b,b as y,c as C}from"./VCard-BBT-dtOV.js";import"./VSelect-DbsyGyf-.js";function W(e,t){var f,o;const r=t.value,w={passive:!((f=t.modifiers)!=null&&f.active)};window.addEventListener("resize",r,w),e._onResize=Object(e._onResize),e._onResize[t.instance.$.uid]={handler:r,options:w},(o=t.modifiers)!=null&&o.quiet||r()}function Y(e,t){var f;if(!((f=e._onResize)!=null&&f[t.instance.$.uid]))return;const{handler:r,options:w}=e._onResize[t.instance.$.uid];window.removeEventListener("resize",r,w),delete e._onResize[t.instance.$.uid]}const j={mounted:W,unmounted:Y},Q={name:"File",components:{ViewLogTable:N},data:()=>({dialog:!1,headers:[{title:"上传日期",sortable:!1,key:"createTime"},{title:"文件名",sortable:!1,key:"uploadFilename"},{title:"路径",sortable:!1,key:"path"},{title:"大小",sortable:!1,key:"size"},{title:"状态",sortable:!1,key:"status"},{title:"操作",key:"actions",sortable:!1}],fileList:[],page:1,size:20,pageCount:0,total:0,deleteItemDate:{uploadFilename:""},showDelete:!1,useSize:0,availableDisk:0,snackbar:!1,message:"删除成功",color:"success",showRename:!1,renameFileDate:{uploadFilename:""},newName:"",loading:!0,windowSize:{x:window.innerWidth,y:window.innerHeight},mobileStatus:!1,showShareDialog:!1,shareItem:{haveUserSeeKey:!1,userSeeKey:""},showseccussShareDialog:!1,successShareInfo:"",showShareBtn:!1,showSeeShareStatusDialog:!1,showShareStatusItme:{}}),created(){const e=parseInt(this.$route.query.page);isNaN(e)||(e<=0?this.page=1:this.page=e),this.initialize(),this.getDiskMessage(),this.checkLogin()},methods:{copy(){navigator.clipboard.writeText(this.successShareInfo)},cancelShare(){this.showShareStatusItme.createTime=0,this.showShareStatusItme.size=0,this.httpPost("/public/file/cancel",this.showShareStatusItme,e=>{e.data?(this.message="取消成功",this.snackbar=!0,this.initialize(),this.showSeeShareStatusDialog=!1):(this.message="取消失败",this.snackbar=!0,this.showSeeShareStatusDialog=!1)})},showShareStatus(e){this.showShareStatusItme=e,this.successShareInfo=`链接：${location.origin}/#/share/file/${this.showShareStatusItme.url}`,this.showShareStatusItme.haveUserSeeKey&&(this.successShareInfo+=`
密码：${this.showShareStatusItme.userSeeKey}`),this.showSeeShareStatusDialog=!0},checkLogin(){this.httpGet("/login/check",e=>{e.status==200?this.showShareBtn=!0:this.showShareBtn=!1})},showShareFileDilog(e){this.shareItem=e,this.showShareDialog=!0},sendSaveShare(){this.shareItem.size=0,this.shareItem.createTime=0,this.httpPost("/public/file",this.shareItem,e=>{e.data!=null?(this.successShareInfo=`链接：${location.origin}/#/share/file/${e.data.url}`,this.shareItem.haveUserSeeKey&&(this.successShareInfo+=`
密码：${this.shareItem.userSeeKey}`),this.showseccussShareDialog=!0,this.showShareDialog=!1,this.initialize()):(this.message=e.message,this.snackbar=!0)})},showFileName(e){return e.length>=40?e.substr(0,15)+"..."+e.substr(e.length-10,10):e},onResize(){this.windowSize={x:window.innerWidth,y:window.innerHeight},this.windowSize.x<=800?this.mobileStatus=!0:this.mobileStatus=!1},pageChange({page:e,itemsPerPage:t,sortBy:r}){this.loading=!0,this.page=e,this.$router.push({path:this.$router.path,query:{page:e}}),this.initialize()},getDiskMessage(){fetch("/api/upload/disk",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"GET",credentials:"include"}).then(e=>e.json()).then(e=>{const t=e.data.userDisk/1024/1024;t<1024?this.useSize=t.toFixed(2)+"MB":this.useSize=(t/1024).toFixed(2)+"GB";const r=e.data.availableDisk/1024/1024;r<1024?this.availableDisk=r.toFixed(2)+"MB":this.availableDisk=(r/1024).toFixed(2)+"GB"}).catch(e=>null)},initialize(){fetch(`/api/file/list?page=${this.page}&size=${this.size}`,{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"GET",credentials:"include"}).then(e=>e.json()).then(e=>{for(var t=0;t<e.page.content.length;t++)e.page.content[t].createTime=this.formateTimeToChinese(e.page.content[t].createTime),e.page.content[t].size=this.showSize(e.page.content[t].size);this.fileList=e.page.content,this.total=e.page.totalElements,this.pageCount=e.page.totalPages,this.loading=!1}).catch(e=>null)},editItem(e){this.renameFileDate=e,this.showRename=!0},reNameOk(){console.log("ok"),this.newName!==""&&(this.renameFileDate.uploadFilename=this.newName,this.renameFileDate.size=0,this.renameFileDate.createTime=0,fetch("/api/file/rename",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"POST",credentials:"include",body:JSON.stringify(this.renameFileDate)}).then(e=>e.json()).then(e=>{e.status===200?(this.message="修改成功！",this.color="success"):(this.message="修改失败！"+e.message,this.color="error"),this.snackbar=!0,this.showRename=!1,this.initialize()}).catch(e=>null))},deleteItem(e){this.deleteItemDate=e,this.showDelete=!0},deleteFile(){console.log(this.deleteItemDate),this.deleteItemDate.size=0,this.deleteItemDate.createTime=0,fetch("/api/file/delete",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"DELETE",credentials:"include",body:JSON.stringify(this.deleteItemDate)}).then(e=>e.json()).then(e=>{e.status===200?(this.message="删除成功！",this.color="success",this.initialize(),this.getDiskMessage()):(this.message="删除失败！"+e.message,this.color="error"),this.showDelete=!1,this.snackbar=!0,this.initialize(),this.getDiskMessage()}).catch(e=>null)},formateTimeToChinese(e){if(e===""||e==null)return"";const t=new Date(e);return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+t.getHours()+"时"+t.getMinutes()+"分"},showSize(e){return e=e/1024,e<1024?e.toFixed(2)+" KB":(e/1024).toFixed(2)+" M"}}},T=e=>(A("data-v-ef4a4f58"),e=e(),J(),e),Z={key:1},ee=["href"],te={class:"text-center pt-2"},ae=["textContent"],se=T(()=>d("br",null,null,-1)),le=T(()=>d("br",null,null,-1)),ie=["textContent"],oe=["textContent"],ne=T(()=>d("br",null,null,-1));function re(e,t,r,w,f,o){const U=x("ViewLogTable");return m(),p(O,{fluid:"",style:{width:"100%"}},{default:s(()=>[z((m(),p($,{headers:e.headers,items:e.fileList,"hide-default-footer":"",page:e.page,"onUpdate:page":t[1]||(t[1]=l=>e.page=l),"item-value":"createTime","items-per-page":e.size,"onUpdate:itemsPerPage":t[2]||(t[2]=l=>e.size=l),"onUpdate:options":o.pageChange,loading:e.loading,mobile:e.mobileStatus},{top:s(()=>[a(X,{flat:"",color:"white"},{default:s(()=>[a(L,null,{default:s(()=>[i("已使用空间："+h(e.useSize)+" 系统剩余空间："+h(e.availableDisk),1)]),_:1}),a(P,{class:"mx-4",inset:"",vertical:""}),a(k),a(n,{color:"primary",onClick:o.initialize},{default:s(()=>[i("刷新文件列表")]),_:1},8,["onClick"])]),_:1})]),"item.uploadFilename":s(({item:l})=>[l.uploadFilename.length>=40?(m(),p(c,{key:0,location:"top",text:l.uploadFilename},{activator:s(({props:u})=>[d("span",_(M(u)),h(o.showFileName(l.uploadFilename)),17)]),_:2},1032,["text"])):(m(),G("span",Z,h(o.showFileName(l.uploadFilename)),1))]),"item.path":s(({item:l})=>[d("a",{class:"overflow-auto",href:`${l.path}?filename=${encodeURIComponent(l.uploadFilename)}&type=inline`,target:"_blank"},h(l.path),9,ee)]),"item.status":s(({item:l})=>[l.publicUser?(m(),p(c,{key:0,location:"start",text:"已共享，点击查看信息！"},{activator:s(({props:u})=>[a(n,V({class:"mr-2",variant:"outlined",density:"compact",color:"deep-purple"},u,{onClick:F=>o.showShareStatus(l)}),{default:s(()=>[i(" 已共享 ")]),_:2},1040,["onClick"])]),_:2},1024)):I("",!0)]),"item.actions":s(({item:l})=>[a(c,{location:"start",text:"下载"},{activator:s(({props:u})=>[a(n,V({class:"mr-2",icon:"mdi-download",density:"compact",color:"success"},u,{target:"_blank",href:`${l.path}?filename=${encodeURIComponent(l.uploadFilename)}&type=attachment`}),null,16,["href"])]),_:2},1024),e.showShareBtn?(m(),p(c,{key:0,location:"start",text:"分享"},{activator:s(({props:u})=>[a(n,V({onClick:F=>o.showShareFileDilog(l),class:"mr-2",icon:"mdi-share",density:"compact",color:"blue"},u),null,16,["onClick"])]),_:2},1024)):I("",!0),a(c,{location:"start",text:"重命名"},{activator:s(({props:u})=>[a(n,V({class:"mr-2",icon:"mdi-pencil",density:"compact"},u,{onClick:F=>o.editItem(l)}),null,16,["onClick"])]),_:2},1024),a(c,{location:"start",text:"删除文件"},{activator:s(({props:u})=>[a(n,V({class:"mr-2",density:"compact",icon:"mdi-delete",color:"error"},u,{onClick:F=>o.deleteItem(l)}),null,16,["onClick"])]),_:2},1024)]),bottom:s(()=>[d("div",te,[a(K,{modelValue:e.page,"onUpdate:modelValue":t[0]||(t[0]=l=>e.page=l),color:"blue","total-visible":5,length:e.pageCount,rounded:"circle"},null,8,["modelValue","length"])])]),_:1},8,["headers","items","page","items-per-page","onUpdate:options","loading","mobile"])),[[j,o.onResize]]),a(v,{modelValue:e.showDelete,"onUpdate:modelValue":t[5]||(t[5]=l=>e.showDelete=l),"max-width":"490"},{default:s(()=>[a(D,null,{default:s(()=>[a(b,{class:"headline"},{default:s(()=>[i("你确定要删除这个文件吗？")]),_:1}),a(y,null,{default:s(()=>[d("span",{textContent:h(e.deleteItemDate.uploadFilename)},null,8,ae),i(),se,le,i(" 删除后将无法恢复，请谨慎操作！！！ ")]),_:1}),a(C,null,{default:s(()=>[a(k),a(n,{color:"green darken-1",text:"",onClick:t[3]||(t[3]=l=>e.showDelete=!1)},{default:s(()=>[i(" 放弃 ")]),_:1}),a(n,{color:"error",text:"",onClick:t[4]||(t[4]=l=>o.deleteFile())},{default:s(()=>[i(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(v,{modelValue:e.showRename,"onUpdate:modelValue":t[8]||(t[8]=l=>e.showRename=l),"max-width":"490"},{default:s(()=>[a(D,null,{default:s(()=>[a(b,{class:"headline"},{default:s(()=>[i("修改文件名")]),_:1}),a(y,null,{default:s(()=>[i(" 原文件名："),d("span",{textContent:h(e.renameFileDate.uploadFilename)},null,8,ie)]),_:1}),a(R,{modelValue:e.newName,"onUpdate:modelValue":t[6]||(t[6]=l=>e.newName=l),variant:"underlined",style:{"margin-right":"20px","margin-left":"20px"},label:"新文件名"},null,8,["modelValue"]),a(C,null,{default:s(()=>[a(k),a(n,{color:"green darken-1",text:"",onClick:t[7]||(t[7]=l=>e.showRename=!1)},{default:s(()=>[i(" 放弃 ")]),_:1}),a(n,{color:"error",text:"",onClick:o.reNameOk},{default:s(()=>[i(" 确认 ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(v,{modelValue:e.showShareDialog,"onUpdate:modelValue":t[13]||(t[13]=l=>e.showShareDialog=l),"max-width":"490"},{default:s(()=>[a(D,null,{default:s(()=>[a(b,{class:"headline"},{default:s(()=>[i("你要将这份文件分享出去吗？")]),_:1}),a(y,null,{default:s(()=>[d("p",null,[d("span",{textContent:h(e.shareItem.uploadFilename)},null,8,oe),ne,i(" 分享后在任何人均可查看 ")]),d("p",null,[a(g,{justify:"center"},{default:s(()=>[a(S,null,{default:s(()=>[a(B,{modelValue:e.shareItem.haveUserSeeKey,"onUpdate:modelValue":t[9]||(t[9]=l=>e.shareItem.haveUserSeeKey=l),color:"blue",label:"是否启用密码"},null,8,["modelValue"])]),_:1})]),_:1}),z(a(g,{justify:"center"},{default:s(()=>[a(S,null,{default:s(()=>[a(R,{modelValue:e.shareItem.userSeeKey,"onUpdate:modelValue":t[10]||(t[10]=l=>e.shareItem.userSeeKey=l),placeholder:"密码",label:"密码",clearable:"",variant:"underlined"},null,8,["modelValue"])]),_:1})]),_:1},512),[[q,e.shareItem.haveUserSeeKey]])])]),_:1}),a(C,null,{default:s(()=>[a(k),a(n,{color:"green darken-1",text:"",onClick:t[11]||(t[11]=l=>e.showShareDialog=!1)},{default:s(()=>[i(" 放弃 ")]),_:1}),a(n,{color:"error",text:"",onClick:t[12]||(t[12]=l=>o.sendSaveShare())},{default:s(()=>[i(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(v,{modelValue:e.showseccussShareDialog,"onUpdate:modelValue":t[15]||(t[15]=l=>e.showseccussShareDialog=l),"max-width":"490"},{default:s(()=>[a(D,null,{default:s(()=>[a(b,{class:"headline"},{default:s(()=>[i("分享成功，复制下面内容给你的好友吧！")]),_:1}),a(y,null,{default:s(()=>[a(g,null,{default:s(()=>[a(S,null,{default:s(()=>[i(h(e.successShareInfo),1)]),_:1})]),_:1}),a(g,null,{default:s(()=>[a(S,null,{default:s(()=>[a(n,{color:"blue-lighten-5",onClick:t[14]||(t[14]=l=>o.copy())},{default:s(()=>[i("复制")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(v,{modelValue:e.showSeeShareStatusDialog,"onUpdate:modelValue":t[19]||(t[19]=l=>e.showSeeShareStatusDialog=l),"max-width":"1000"},{default:s(()=>[a(D,null,{default:s(()=>[a(b,{class:"headline"},{default:s(()=>[i("分享")]),_:1}),a(y,null,{default:s(()=>[a(g,null,{default:s(()=>[a(S,null,{default:s(()=>[i(h(e.successShareInfo),1)]),_:1})]),_:1}),a(g,null,{default:s(()=>[a(S,null,{default:s(()=>[a(n,{color:"blue-lighten-5",onClick:t[16]||(t[16]=l=>o.copy())},{default:s(()=>[i("复制")]),_:1})]),_:1})]),_:1}),a(U,{target:e.showShareStatusItme.id,types:1},null,8,["target"])]),_:1}),a(C,null,{default:s(()=>[a(k),a(n,{color:"green darken-1",text:"",onClick:t[17]||(t[17]=l=>e.showSeeShareStatusDialog=!1)},{default:s(()=>[i(" 关闭 ")]),_:1}),e.showShareBtn?(m(),p(n,{key:0,color:"error",text:"",onClick:t[18]||(t[18]=l=>o.cancelShare())},{default:s(()=>[i(" 取消分享 ")]),_:1})):I("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(H,{modelValue:e.snackbar,"onUpdate:modelValue":t[20]||(t[20]=l=>e.snackbar=l),color:e.color,timeout:3e3,top:!0},{default:s(()=>[i(h(e.message),1)]),_:1},8,["modelValue","color"])]),_:1})}const fe=E(Q,[["render",re],["__scopeId","data-v-ef4a4f58"]]);export{fe as default};
