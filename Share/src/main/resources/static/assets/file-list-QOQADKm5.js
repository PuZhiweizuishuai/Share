import{_ as U,d as O,c as f,w as l,r as o,o as p,e as X,a,f as s,t as d,b as m,n as $,g as x,h as B,m as v,p as K,i as M}from"./index-oNAIta96.js";const P={name:"File",data:()=>({dialog:!1,headers:[{align:"start",title:"上传日期",sortable:!1,key:"createTime"},{title:"文件名",sortable:!1,key:"uploadFilename"},{title:"路径",sortable:!1,key:"path"},{title:"大小",sortable:!1,key:"size"},{title:"操作",key:"actions",sortable:!1}],fileList:[],page:1,size:20,pageCount:0,total:0,deleteItemDate:{uploadFilename:""},showDelete:!1,useSize:0,availableDisk:0,snackbar:!1,message:"删除成功",color:"success",showRename:!1,renameFileDate:{uploadFilename:""},newName:"",loading:!0,windowSize:{x:window.innerWidth,y:window.innerHeight},mobileStatus:!1}),created(){const e=parseInt(this.$route.query.page);isNaN(e)||(e<=0?this.page=1:this.page=e),this.initialize(),this.getDiskMessage()},methods:{showFileName(e){return e.length>=40?e.substr(0,15)+"..."+e.substr(e.length-10,10):e},onResize(){this.windowSize={x:window.innerWidth,y:window.innerHeight},this.windowSize.x<=600?this.mobileStatus=!0:this.mobileStatus=!1},pageChange({page:e,itemsPerPage:t,sortBy:h}){this.loading=!0,this.page=e,this.$router.push({path:this.$router.path,query:{page:e}}),this.initialize()},getDiskMessage(){fetch("/api/upload/disk",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"GET",credentials:"include"}).then(e=>e.json()).then(e=>{const t=e.data.userDisk/1024/1024;t<1024?this.useSize=t.toFixed(2)+"MB":this.useSize=(t/1024).toFixed(2)+"GB";const h=e.data.availableDisk/1024/1024;h<1024?this.availableDisk=h.toFixed(2)+"MB":this.availableDisk=(h/1024).toFixed(2)+"GB"}).catch(e=>null)},initialize(){fetch(`/api/file/list?page=${this.page}&size=${this.size}`,{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"GET",credentials:"include"}).then(e=>e.json()).then(e=>{for(var t=0;t<e.page.content.length;t++)e.page.content[t].createTime=this.formateTimeToChinese(e.page.content[t].createTime),e.page.content[t].size=this.showSize(e.page.content[t].size);this.fileList=e.page.content,this.total=e.page.totalElements,this.pageCount=e.page.totalPages,this.loading=!1}).catch(e=>null)},editItem(e){this.renameFileDate=e,this.showRename=!0},reNameOk(){console.log("ok"),this.newName!==""&&(this.renameFileDate.uploadFilename=this.newName,this.renameFileDate.size=0,this.renameFileDate.createTime=0,fetch("/api/file/rename",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"POST",credentials:"include",body:JSON.stringify(this.renameFileDate)}).then(e=>e.json()).then(e=>{e.status===200?(this.message="修改成功！",this.color="success"):(this.message="修改失败！"+e.message,this.color="error"),this.snackbar=!0,this.showRename=!1,this.initialize()}).catch(e=>null))},deleteItem(e){this.deleteItemDate=e,this.showDelete=!0},deleteFile(){console.log(this.deleteItemDate),this.deleteItemDate.size=0,this.deleteItemDate.createTime=0,fetch("/api/file/delete",{headers:{"Content-Type":"application/json; charset=UTF-8","X-XSRF-TOKEN":this.$cookies.get("XSRF-TOKEN")},method:"DELETE",credentials:"include",body:JSON.stringify(this.deleteItemDate)}).then(e=>e.json()).then(e=>{e.status===200?(this.message="删除成功！",this.color="success",this.initialize(),this.getDiskMessage()):(this.message="删除失败！"+e.message,this.color="error"),this.showDelete=!1,this.snackbar=!0,this.initialize(),this.getDiskMessage()}).catch(e=>null)},formateTimeToChinese(e){if(e===""||e==null)return"";const t=new Date(e);return t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日 "+t.getHours()+"时"+t.getMinutes()+"分"},showSize(e){return e=e/1024,e<1024?e.toFixed(2)+" KB":(e/1024).toFixed(2)+" M"}}},D=e=>(K("data-v-24562b74"),e=e(),M(),e),L={key:1},G=["href"],H={class:"text-center pt-2"},q=["textContent"],J=D(()=>m("br",null,null,-1)),W=D(()=>m("br",null,null,-1)),Y=["textContent"];function A(e,t,h,Q,Z,n){const C=o("v-toolbar-title"),T=o("v-divider"),g=o("v-spacer"),r=o("v-btn"),y=o("v-toolbar"),u=o("v-tooltip"),z=o("v-pagination"),S=o("v-data-table-server"),_=o("v-card-title"),k=o("v-card-text"),b=o("v-card-actions"),w=o("v-card"),F=o("v-dialog"),N=o("v-text-field"),R=o("v-snackbar"),I=o("v-container"),V=O("resize");return p(),f(I,{fluid:""},{default:l(()=>[X((p(),f(S,{density:"compact",headers:e.headers,items:e.fileList,page:e.page,"onUpdate:page":t[1]||(t[1]=i=>e.page=i),"item-value":"createTime","items-per-page":e.size,"onUpdate:itemsPerPage":t[2]||(t[2]=i=>e.size=i),"onUpdate:options":n.pageChange,loading:e.loading,mobile:e.mobileStatus},{top:l(()=>[a(y,{flat:"",color:"white"},{default:l(()=>[a(C,null,{default:l(()=>[s("已使用空间："+d(e.useSize)+" 系统剩余空间："+d(e.availableDisk),1)]),_:1}),a(T,{class:"mx-4",inset:"",vertical:""}),a(g),a(r,{color:"primary",onClick:n.initialize},{default:l(()=>[s("刷新文件列表")]),_:1},8,["onClick"])]),_:1})]),"item.uploadFilename":l(({item:i})=>[i.uploadFilename.length>=40?(p(),f(u,{key:0,location:"top",text:i.uploadFilename},{activator:l(({props:c})=>[m("span",$(x(c)),d(n.showFileName(i.uploadFilename)),17)]),_:2},1032,["text"])):(p(),B("span",L,d(n.showFileName(i.uploadFilename)),1))]),"item.path":l(({item:i})=>[m("a",{class:"overflow-auto",href:`${i.path}?filename=${encodeURIComponent(i.uploadFilename)}&type=inline`,target:"_blank"},d(i.path),9,G)]),"item.actions":l(({item:i})=>[a(u,{location:"start",text:"下载"},{activator:l(({props:c})=>[a(r,v({class:"mr-2",icon:"mdi-download",density:"compact",color:"success"},c,{target:"_blank",href:`${i.path}?filename=${encodeURIComponent(i.uploadFilename)}&type=attachment`}),null,16,["href"])]),_:2},1024),a(u,{location:"start",text:"重命名"},{activator:l(({props:c})=>[a(r,v({class:"mr-2",icon:"mdi-pencil",density:"compact"},c,{onClick:E=>n.editItem(i)}),null,16,["onClick"])]),_:2},1024),a(u,{location:"start",text:"删除文件"},{activator:l(({props:c})=>[a(r,v({class:"mr-2",density:"compact",icon:"mdi-delete",color:"error"},c,{onClick:E=>n.deleteItem(i)}),null,16,["onClick"])]),_:2},1024)]),"no-data":l(()=>[a(r,{color:"primary",onClick:n.initialize},{default:l(()=>[s("Reset")]),_:1},8,["onClick"])]),bottom:l(()=>[m("div",H,[a(z,{modelValue:e.page,"onUpdate:modelValue":t[0]||(t[0]=i=>e.page=i),color:"blue","total-visible":5,length:e.pageCount,rounded:"circle"},null,8,["modelValue","length"])])]),_:1},8,["headers","items","page","items-per-page","onUpdate:options","loading","mobile"])),[[V,n.onResize]]),a(F,{modelValue:e.showDelete,"onUpdate:modelValue":t[5]||(t[5]=i=>e.showDelete=i),"max-width":"490"},{default:l(()=>[a(w,null,{default:l(()=>[a(_,{class:"headline"},{default:l(()=>[s("你确定要删除这个文件吗？")]),_:1}),a(k,null,{default:l(()=>[m("span",{textContent:d(e.deleteItemDate.uploadFilename)},null,8,q),s(),J,W,s(" 删除后将无法恢复，请谨慎操作！！！ ")]),_:1}),a(b,null,{default:l(()=>[a(g),a(r,{color:"green darken-1",text:"",onClick:t[3]||(t[3]=i=>e.showDelete=!1)},{default:l(()=>[s(" 放弃 ")]),_:1}),a(r,{color:"error",text:"",onClick:t[4]||(t[4]=i=>n.deleteFile())},{default:l(()=>[s(" 确认 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(F,{modelValue:e.showRename,"onUpdate:modelValue":t[8]||(t[8]=i=>e.showRename=i),"max-width":"490"},{default:l(()=>[a(w,null,{default:l(()=>[a(_,{class:"headline"},{default:l(()=>[s("修改文件名")]),_:1}),a(k,null,{default:l(()=>[s(" 原文件名："),m("span",{textContent:d(e.renameFileDate.uploadFilename)},null,8,Y)]),_:1}),a(N,{modelValue:e.newName,"onUpdate:modelValue":t[6]||(t[6]=i=>e.newName=i),variant:"underlined",style:{"margin-right":"20px","margin-left":"20px"},label:"新文件名"},null,8,["modelValue"]),a(b,null,{default:l(()=>[a(g),a(r,{color:"green darken-1",text:"",onClick:t[7]||(t[7]=i=>e.showRename=!1)},{default:l(()=>[s(" 放弃 ")]),_:1}),a(r,{color:"error",text:"",onClick:n.reNameOk},{default:l(()=>[s(" 确认 ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(R,{modelValue:e.snackbar,"onUpdate:modelValue":t[9]||(t[9]=i=>e.snackbar=i),color:e.color,timeout:3e3,top:!0},{default:l(()=>[s(d(e.message),1)]),_:1},8,["modelValue","color"])]),_:1})}const ee=U(P,[["render",A],["__scopeId","data-v-24562b74"]]);export{ee as default};
